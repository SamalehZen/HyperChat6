## Summary
Replace Clerk with local authentication (Prisma + httpOnly cookies) to meet security, control and compliance requirements. Add an Admin dashboard for complete account lifecycle, online presence, and 90‑day activity history. Keep existing API credit model compatible while removing Clerk entirely.

## Changes
- Database (Prisma)
  - Add Role enum, User, Session, ActivityLog models with indexes and cascades
  - Generate migration and Prisma Client
- Backend (Next.js App Router)
  - New auth library: getSession, requireAuth, requireAdmin, cookie helpers, heartbeat updates (apps/web/app/api/_lib/auth.ts)
  - Auth routes: POST /api/auth/login, POST /api/auth/logout, GET /api/auth/me, POST /api/auth/heartbeat, POST /api/auth/setup
  - Admin routes (all require admin):
    - GET /api/admin/users (list + filters), POST /api/admin/users (create)
    - PATCH/DELETE /api/admin/users/[id] (reset password, suspend/unsuspend, update role, delete)
    - GET /api/admin/users/[id]/activity (paginated, sort asc/desc)
    - GET /api/admin/online (current online users by latest session heartbeat)
  - Adapt existing API routes to local auth (no Clerk): completion, messages/remaining, feedback
  - Middleware: replace clerkMiddleware by a minimal Node runtime middleware with optional redirect for /admin
- Frontend
  - Remove Clerk provider/hooks; add local AuthProvider with useAuth/useUser hooks compatible with existing UI expectations
  - Sign‑in page replaced by email/password form
  - Admin page at /admin with: list, search/filter, actions per user (reset/suspend/unsuspend/delete/change role), “Users online” panel, and a new “Activity details” modal (pagination + date sort)
  - Heartbeat client to POST /api/auth/heartbeat every 60s while signed in
  - Update all components that used @clerk/nextjs to use local context
- DevOps / Docs
  - .env.example: add ADMIN_EMAIL, ADMIN_PASSWORD, SESSION_SECRET; remove Clerk keys
  - Add purge script for ActivityLog > 90 days (apps/web/scripts/purge-activity-logs.ts)
  - README: add “Authentification locale” section (env, endpoints, flows, purge, migration note)

## Why
- Eliminate third‑party auth dependency and centralize control of user/session lifecycle
- Enforce httpOnly cookie sessions (30 days) with bcrypt passwords and admin‑only account creation
- Provide real‑time visibility of online users with IP/Geo via Vercel headers only
- Preserve existing credits logic and headers for compatibility

## Impact
- Clerk fully removed (packages, middleware, hooks, imports) — the build no longer depends on @clerk/nextjs
- New DB tables required — run Prisma migrations
- Admin must bootstrap first account via /api/auth/setup or provided init script

## Deployment notes
1) Set env vars: DATABASE_URL, ADMIN_EMAIL, ADMIN_PASSWORD, SESSION_SECRET, FREE_CREDITS_LIMIT_REQUESTS_AUTH/IP
2) Run Prisma:
   - prisma generate
   - prisma migrate deploy
3) Initialize admin once:
   - POST /api/auth/setup
4) (Optional) Cron: run apps/web/scripts/purge-activity-logs.ts daily

## Acceptance alignment
- [x] Clerk removed; middleware replaced; build ok
- [x] Local auth operational (login/logout/me/cookie 30j)
- [x] /admin restricted (server‑side requireAdmin) with user management + ActivityLog
- [x] Online users reflects active sessions (lastSeen < 120s), shows IP/country/region/city
- [x] Activity history paginated with 90‑day retention + purge script
- [x] First admin via /api/auth/setup (idempotent)
- [x] completion/messages/remaining keep working with credits and headers
- [x] README updated for local auth


₍ᐢ•(ܫ)•ᐢ₎ Generated by [Capy](https://capy.ai) ([view task](https://capy.ai/project/fa296dc7-f478-4d41-b8b4-bb8ec362b499/task/ef7f4edb-ab17-4ba2-b64c-3753030bdd20))